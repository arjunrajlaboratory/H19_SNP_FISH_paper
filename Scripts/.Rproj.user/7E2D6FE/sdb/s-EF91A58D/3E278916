{
    "contents" : "library(plyr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\nlibrary(yaml)\nlibrary(reshape2)\n\nsource('SET_ABSOLUTE_PATH.R')\n\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Data_CxB_MEF_9CG_R\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 3/')\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\n\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoRatio <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono = mono >= 0.8) %>% arrange(isMono, (B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\n\n\ntotalH19 <- dataTable %>% group_by(cellID) %>% summarise(totalH19 = n())\ncellCounts_forPlot_Wide<- left_join(cellCounts_forPlot_Wide, totalH19)\n\nScatterRatio <- ggplot() +\n  geom_point(data = cellCounts_forPlot_Wide, aes(x = mono, y = totalH19, size = 3, colour = \"blue\")) +\n  geom_line(aes(x = 0.8, y =seq(0,4000,100), colour = 'red') )+\n  xlab(\"C7 Ratio\") +\n  ylab(\"Total H19 RNA Count\") +\n  xlim(0,1) +\n  ylim(0,4000) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ggtitle(expData$name)\nplot(ScatterRatio)\n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = ScatterRatio,  width = 9.89, height = 9,   filename =  paste(\"9CG_H19_Threshold_Scatter.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\nmeanExpressionPlot <- ggplot() +\n  geom_boxplot(data = cellCounts_forPlot_Wide, aes(x = isMono, y = totalH19)) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ylab(\"Total H19 RNA Count\") \nplot(meanExpressionPlot) \n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = meanExpressionPlot,  width = 5.89, height = 9,   filename =  paste(\"Mono_vs_Bi_CellCounts.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n##Calculate P value\n\nresult <- t.test(cellCounts_forPlot_Wide$totalH19 ~ cellCounts_forPlot_Wide$isMono)\nresult\n\ndiff <- 0;\nfor(runID in seq(1,10000)){\n  randPerm <- sample(cellCounts_forPlot_Wide$isMono)\n  meanMono <- mean(cellCounts_forPlot_Wide$totalH19[randPerm]);\n  meanBi <- mean(cellCounts_forPlot_Wide$totalH19[!randPerm]);\n  diff[runID] <- meanBi - meanMono\n}\n\ncumDist <- ecdf(diff)\npvalue <- 1 -cumDist(277.4)\nsummary(cellCounts_forPlot_Wide$isMono)\n\n## WT SCATTER ########\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Data_CxB_MEF_WT_IGF2_2\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 3/')\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\n\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\n\n\n\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\nbyCellCounts_wide <- filter(byCellCounts_wide, cellID < 113) #Photobleaching in final positions- throw out cells\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoRatio <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono = mono >= 0.8) %>% arrange(isMono, (B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\n\ntotalH19 <- dataTable %>% group_by(cellID) %>% summarise(totalH19 = n())\ncellCounts_forPlot_Wide<- left_join(cellCounts_forPlot_Wide, totalH19)\n\nScatterRatio <- ggplot() +\n  geom_point(data = cellCounts_forPlot_Wide, aes(x = mono, y = totalH19, size = 3)) +\n  geom_line(aes(x = 0.8, y =seq(0,4000,100), colour = 'red'))+\n  xlab(\"C7 Ratio\") +\n  ylab(\"Total H19 RNA Count\") +\n  xlim(0,1) +\n  ylim(0,3000) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ggtitle(expData$name)\nplot(ScatterRatio)\n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = ScatterRatio,  width = 9.89, height = 9,   filename =  paste(\"WT_H19_Threshold_Scatter.pdf\", sep = \"_\"))\nsetwd(currdir)\n\nplot(ScatterRatio)\n\n\n",
    "created" : 1449105232390.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2956303280",
    "id" : "3E278916",
    "lastKnownWriteTime" : 1449238468,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeSuppFigure3.R",
    "project_path" : "makeSuppFigure3.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}