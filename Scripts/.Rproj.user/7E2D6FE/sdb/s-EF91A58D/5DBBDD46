{
    "contents" : "\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(dplyr)\n\nsource('SET_ABSOLUTE_PATH.R')\n\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Data_CxB_9CG_MEFinCRL\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 5/')\n\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ncellArrayObj <- tbl_df(read.csv(paste(datadir, \"ExtractedCSVs/\", expData$name, '_CellArrayObj.csv', sep = \"\"), stringsAsFactors = T))\n\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNP\"=\"B6\", \"C7 H19 SNP\"=\"C7\",\n                                                \"H19 B6 SNP\" = \"B6\", \"H19 CAST SNP\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\n\n\ngrouped_Positions <- c(8,10,13,16)\n\nclusterID <- 1;\ncellArrayObj$clusterID = 1;\nfor (i in seq(2,nrow(cellArrayObj))){\n  if ((cellArrayObj$ArrayNum[i-1] == cellArrayObj$ArrayNum[i]) || (cellArrayObj$ArrayNum[i] %in% grouped_Positions)) {\n    cellArrayObj$clusterID[i] <- clusterID    \n  }\n  else{\n    clusterID <- clusterID + 1\n    cellArrayObj$clusterID[i] <- clusterID \n  }\n}\n\n\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% left_join(cellArrayObj)\n\n\nnullRow <- as.data.frame(t(rep(0,8)))\nnullRow <- rbind(nullRow, nullRow, nullRow, nullRow)\ncolnames(nullRow) <- colnames(cellCounts_forPlot_Wide)\n\n\nnewCellCounts_forPlot_Wide <- cellCounts_forPlot_Wide[1,]\n\nfor (i in seq(2, nrow(cellCounts_forPlot_Wide))){\n  if (cellCounts_forPlot_Wide$clusterID[i] != cellCounts_forPlot_Wide$clusterID[i-1]){\n    newCellCounts_forPlot_Wide <- rbind(newCellCounts_forPlot_Wide, nullRow)\n  }\n  newCellCounts_forPlot_Wide <- rbind(newCellCounts_forPlot_Wide, cellCounts_forPlot_Wide[i,])\n}\n\n\n\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\n\nnewCellCounts_forPlot_Wide$numRow = 1:nrow(newCellCounts_forPlot_Wide)\n\n\nupDownBar2 <- ggplot() +\n  geom_bar(data = newCellCounts_forPlot_Wide, aes(x = 1:nrow(newCellCounts_forPlot_Wide), y = -C7,\n                                                  fill = \"C7\"), stat = \"identity\", position = \"dodge\") +\n  geom_bar(data = newCellCounts_forPlot_Wide, aes(x = 1:nrow(newCellCounts_forPlot_Wide), y = B6, fill = \"B6\"), stat = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\"), name = 'Allele') +\n  ggtitle(expData$name)\nplot(upDownBar2)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(\"SUPPFigure5_COLONY_PLOT_ALL.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n\n### COMPARISON SCRIPTS\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"IGF2+ MEF Colony CS\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 5/')\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, \"Clone Bisulfite/07-27-2015_IGF2+_1-3_4x/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"H19 B6\"=\"B6\", \"H19 CAST\"=\"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\n\nbyCellCounts_wide <- byCellCounts_wide[1:30,]\n\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoRatio <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono = mono >= 0.8) %>% arrange((B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\nfracMono = sum(cellCounts_forPlot_Wide$isMono)/nrow(cellCounts_forPlot_Wide);\nfracBi = 1 - fracMono;\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\nupDownBar2 <- ggplot() +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= -C7, fill = \"C7\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= B6, fill = \"B6\"), stat = \"identity\",\n           position = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 12, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(graphName)\nplot(upDownBar2)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar2, filename =   paste(graphName,\"UPDOWNBAR.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Col2\n\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Bi MEF Colony R\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 5/')\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, \"Clone Bisulfite/06-04-2015_Bi_5-3_1x/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"H19 B6\"=\"B6\", \"H19 CAST\"=\"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\n\nbyCellCounts_wide <- byCellCounts_wide[1:30,]\n\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoRatio <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono = mono >= 0.8) %>% arrange((B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\nfracMono = sum(cellCounts_forPlot_Wide$isMono)/nrow(cellCounts_forPlot_Wide);\nfracBi = 1 - fracMono;\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\nupDownBar2 <- ggplot() +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= -C7, fill = \"C7\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= B6, fill = \"B6\"), stat = \"identity\",\n           position = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 12, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(graphName)\nplot(upDownBar2)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar2, filename =   paste(graphName,\"UPDOWNBAR.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n\n\n\n\n",
    "created" : 1449238489098.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1320806843",
    "id" : "5DBBDD46",
    "lastKnownWriteTime" : 1449240267,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeSuppFigure5.R",
    "project_path" : "makeSuppFigure5.R",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "type" : "r_source"
}