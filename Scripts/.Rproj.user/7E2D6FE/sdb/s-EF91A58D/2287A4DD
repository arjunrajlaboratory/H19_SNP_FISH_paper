{
    "contents" : "#Makes Descending Plots for Figure 2\n\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\nlibrary(yaml)\nlibrary(reshape2)\n\nsource('SET_ABSOLUTE_PATH.R')\n\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Data_CxB_MEF_9CG_R\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Figure 2')\n\n\n\n\n## MAKE MUT DESCENDING PLOT\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\n\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoRatio <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono = mono >= 0.8) %>% arrange(isMono, (B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\nfracMono = sum(cellCounts_forPlot_Wide$isMono)/nrow(cellCounts_forPlot_Wide);\nfracBi = 1 - fracMono;\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\nupDownBar2 <- ggplot() +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= -C7, fill = \"C7\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= B6, fill = \"B6\"), stat = \"identity\",\n           position = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(upDownBar2)\n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(graphName,\"Figure2_Plot_9CG.pdf\", sep = \"_\")) \nsetwd(currdir)\n\ntotals_forPlot <- totals %>% filter(labels %in% c(\"B6\", \"C7\")) %>% mutate(relFrac = totalCount/sum(totalCount))\nbarPlot <- ggplot() + \n  geom_bar(data = totals_forPlot, aes(x = c('9CG MEF', '9CG MEF'), y = relFrac, fill = labels, position = \"stack\"), stat=\"identity\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(barPlot)\n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = barPlot,  width = 9.89, height = 9, filename =  paste(graphName,\"Figure2_RelativeFrac_Plot_9CG.pdf\", sep = \"_\")) \nsetwd(currdir)\n\n## MAKE WT DESCENDING PLOT #################\n\n\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Data_CxB_MEF_WT_IGF2_2\"\npixelShift <- F\noutdir <- file.path(PROJHOME, 'Plots/Figure 2')\n\n\n## MAKE MUT DESCENDING PLOT\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\n\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\n\n\n\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\nbyCellCounts_wide <- filter(byCellCounts_wide, cellID < 113) #Photobleaching in final positions- throw out cells\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoRatio <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono = mono >= 0.8) %>% arrange(isMono, (B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\nfracMono = sum(cellCounts_forPlot_Wide$isMono)/nrow(cellCounts_forPlot_Wide);\nfracBi = 1 - fracMono;\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\nupDownBar2 <- ggplot() +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= -C7, fill = \"C7\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= B6, fill = \"B6\"), stat = \"identity\",\n           position = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(upDownBar2)\n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(graphName,\"Figure2_Plot_WT.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n",
    "created" : 1449239629578.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2375406881",
    "id" : "2287A4DD",
    "lastKnownWriteTime" : 1449095551,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeFigure2.R",
    "project_path" : "makeFigure2.R",
    "properties" : {
    },
    "relative_order" : 9,
    "source_on_save" : false,
    "type" : "r_source"
}