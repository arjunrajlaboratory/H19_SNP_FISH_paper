{
    "contents" : "#Receives data directory and makes standard figures\n\n\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\nlibrary(yaml)\nlibrary(reshape2)\n\n\ndataSelections <- c(\"Data_BxB_MEF_WT_Control\",\n                    \"Data_BxC_MEF_WT_Control\",\n                    \"Data_CxB_MEF_WT_Control\",\n                    \"Data_CxC_MEF_WT_Control\",)\nfor (i in c(T, F)){\nfor (data in dataSelections){\n\ndatadir <- \"/Users/paulginart/Dropbox/H19 SNP-FISH Paper/Raw Data/\"\ndataSelect <- data\npixelShift <- i\noutdir <- \"/Users/paulginart/Dropbox/H19 SNP-FISH Paper/Plots/\"\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\noutSelectdir <- paste(outdir,dataSelect, \"/\", sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\n\n\n##Plotting.....\n\n\n#Plot first 50 cells that have at least 50 detected RNAs\ncellCounts_forPlot_Wide <- byCellCounts %>% filter(B6 + C7 >= 50) %>% mutate(plot_idx = seq(1,n()))\ncellCounts_forPlot_Long <- cellCounts_forPlot_Wide %>% gather(labels, rnaCount, -cellID, -plot_idx)\n\n\n\n\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\n\nC7Counts <- cellCounts_forPlot_Long %>% filter(labels == \"C7\")\nB6Counts <- cellCounts_forPlot_Long %>% filter(labels == \"B6\")\nupDownBar2 <- ggplot() +\n  geom_bar(data = C7Counts, aes(x = plot_idx, y= -rnaCount, fill = labels), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = B6Counts, aes(x = plot_idx, y= rnaCount, fill = labels), stat = \"identity\",\n           position = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(upDownBar2)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(graphName,\"UpDownBar_50.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n#All CELLS\nAllcellCounts_forPlot <- byCellCounts %>% mutate(plot_idx = seq(1,n())) %>% gather(labels, rnaCount, -cellID, -plot_idx)\nAllC7Counts <- AllcellCounts_forPlot %>% filter(labels == \"C7\")\nAllB6Counts <- AllcellCounts_forPlot %>% filter(labels == \"B6\")\n\n\nupDownBar <- ggplot() +\n  geom_bar(data = AllC7Counts, aes(x = plot_idx, y= -rnaCount, fill = labels), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = AllB6Counts, aes(x = plot_idx, y= rnaCount, fill = labels), stat = \"identity\",\n           position = \"identity\") +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(upDownBar)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = upDownBar, width = 6.42, height = 7.11,    filename =  paste(graphName,\"UpDownBar_All.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n\n## Plot Pie Graph\nblank_theme <- theme_minimal()+\n  theme(\n    axis.title.x = element_blank(),\n    axis.title.y = element_blank(),\n    panel.border = element_blank(),\n    panel.grid=element_blank(),\n    axis.ticks = element_blank(),\n    plot.title=element_text(size=14, face=\"bold\")\n  )\n\noverallPieChart <- ggplot(data = totals) +\n      geom_bar(aes(x=\"\", y = totalFrac, fill = labels), stat = \"identity\", width = 1) +\n      coord_polar(theta=\"y\") + blank_theme + \n      theme(axis.text.x=element_blank()) +\n      geom_text(aes(x = 1.8,  y = totalFrac/3 + c(0,cumsum(totalFrac[-length(totalFrac)])),\n                label = percent(totalFrac)), size=5) +\n      scale_fill_manual(values = colorVec) +\n      ggtitle(expData$name)\nplot(overallPieChart)\n\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = overallPieChart, filename =   paste(graphName, \"OverallPie.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n#Stacked Bar- Total Counts\nStackedBar_total <- ggplot(data = AllcellCounts_forPlot) +\n          geom_bar(aes(x = plot_idx, y = rnaCount, fill= labels), stat = \"identity\") +\n          xlab(\"Individual Cells\") +\n          ylab(\"RNA Count\") +\n          theme_bw(base_size = 20, base_family = \"Helvetica\") +\n          scale_fill_manual(values = colorVec) +\n          ggtitle(expData$name)\nplot(StackedBar_total)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = StackedBar_total, height = 6.42, width = 9.89, filename =  paste(graphName, \"stackedbar_total.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\nC7Ratio <- cellCounts_forPlot_Long %>% filter(labels %in% c(\"B6\", \"C7\")) %>%\n          group_by(cellID) %>%  mutate(rnaFrac = rnaCount/sum(rnaCount), detecRNA = sum(rnaCount)) %>%\n          filter(labels == \"C7\")\n\nScatterRatio <- ggplot(data = C7Ratio) +\n  geom_point(aes(x = rnaFrac, y = detecRNA)) +\n  xlab(\"C7 Ratio\") +\n  ylab(\"Detected H19 RNA Count\") +\n  xlim(0,1) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ggtitle(expData$name)\nplot(ScatterRatio)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = ScatterRatio, height = 6.42, width = 9.89, filename =  paste(graphName, \"Scatter_Ratio.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\nC7Hist <- ggplot(data = C7Ratio) +\n  geom_histogram(aes(x = rnaFrac, y = ..count..)) +\n  xlab(\"C7 Ratio\") +\n  xlim(0,1) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ggtitle(expData$name)\nplot(C7Hist)\ncurrdir <- getwd()\nsetwd(outSelectdir)\nggsave(plot = C7Hist, height = 6.42, width = 9.89, filename =  paste(graphName, \"C7Hist.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n}\n}\n\n",
    "created" : 1449089259595.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3398615189",
    "id" : "C2C23E1D",
    "lastKnownWriteTime" : 1447206953,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeStandardFigures_loop.R",
    "project_path" : "makeStandardFigures_loop.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}