{
    "contents" : "\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\nlibrary(yaml)\nlibrary(reshape2)\n\nsource('SET_ABSOLUTE_PATH.R')\n\n\ndataSelections <- c(\"Data_BxB_MEF_WT_Control\",\n                    \"Data_BxC_MEF_WT_Control\",\n                    \"Data_CxB_MEF_WT_Control\",\n                    \"Data_CxC_MEF_WT_Control\",\n                    \"Data_CXB_MEF_9CG_R\",\n                    \"Data_CXB_MEF_9CG_CS\")\nfor (i in c(F)){\n  for (data in dataSelections){\n    \n    datadir <- file.path(PROJHOME, 'Raw Data/')\n    dataSelect <- data\n    pixelShift <- i\n    outSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 2/')\n    \n    \n    dataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n    \n    yamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\n    expData <- yaml.load_file(yamldir)\n    \n    if (!pixelShift) {\n      csv <- '_MasterGuideSpotsTable.csv'\n      graphName <- dataSelect\n    }else {\n      csv <- '_MasterGuideSpotsTable_Shifted.csv'\n      graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n    }\n    \n    tabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n    \n    dataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\n    dataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                    \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\n    dataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n    \n    byCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n    \n    totals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\n    totals$name <- as.factor(dataSelect)\n    totals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n    \n    byCellCounts <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\n    \n    \n    ##Plotting.....\n    \n    \n    #Plot first 50 cells that have at least 50 detected RNAs\n    cellCounts_forPlot_Wide <- byCellCounts %>% filter(B6 + C7 >= 50) %>% mutate(plot_idx = seq(1,n()))\n    cellCounts_forPlot_Long <- cellCounts_forPlot_Wide %>% gather(labels, rnaCount, -cellID, -plot_idx)\n    \n    \n    \n    \n    #Color Values\n    colorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n    \n    \n    C7Counts <- cellCounts_forPlot_Long %>% filter(labels == \"C7\")\n    B6Counts <- cellCounts_forPlot_Long %>% filter(labels == \"B6\")\n\n    #All CELLS\n    AllcellCounts_forPlot <- byCellCounts %>% mutate(plot_idx = seq(1,n())) %>% gather(labels, rnaCount, -cellID, -plot_idx)\n    AllC7Counts <- AllcellCounts_forPlot %>% filter(labels == \"C7\")\n    AllB6Counts <- AllcellCounts_forPlot %>% filter(labels == \"B6\")\n    \n    \n    ## Plot Pie Graph\n    blank_theme <- theme_minimal()+\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        panel.border = element_blank(),\n        panel.grid=element_blank(),\n        axis.ticks = element_blank(),\n        plot.title=element_text(size=14, face=\"bold\")\n      )\n    \n    overallPieChart <- ggplot(data = totals) +\n      geom_bar(aes(x=\"\", y = totalFrac, fill = labels), stat = \"identity\", width = 1) +\n      coord_polar(theta=\"y\") + blank_theme + \n      theme(axis.text.x=element_blank()) +\n      geom_text(aes(x = 1.8,  y = totalFrac/3 + c(0,cumsum(totalFrac[-length(totalFrac)])),\n                    label = percent(totalFrac)), size=5) +\n      scale_fill_manual(values = colorVec) +\n      ggtitle(expData$name)\n    plot(overallPieChart)\n    \n    currdir <- getwd()\n    setwd(outSelectdir)\n    ggsave(plot = overallPieChart, filename =   paste(graphName, \"OverallPie.pdf\", sep = \"_\"))\n    setwd(currdir)\n    \n    \n    \n  }\n}\n\n\n## PIXEL SHIFT PIE CHART\n    \n    datadir <- file.path(PROJHOME, 'Raw Data/')\n    dataSelect <- \"Data_CxB_MEF_WT_Control\"\n    pixelShift <- F\n    outSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 2/')\n    \n    \n    dataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\n    yamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\n    expData <- yaml.load_file(yamldir)\n    \n    if (!pixelShift) {\n      csv <- '_MasterGuideSpotsTable.csv'\n      graphName <- dataSelect\n    }else {\n      csv <- '_MasterGuideSpotsTable_Shifted.csv'\n      graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n    }\n    \n    tabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n    \n    dataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\n    dataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                    \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\n    dataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n    \n    byCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n())\n    \n    totals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\n    totals$name <- as.factor(dataSelect)\n    totals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n    \n    byCellCounts <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\n    \n    \n    ##Plotting.....\n    \n    \n    #Plot first 50 cells that have at least 50 detected RNAs\n    cellCounts_forPlot_Wide <- byCellCounts %>% filter(B6 + C7 >= 50) %>% mutate(plot_idx = seq(1,n()))\n    cellCounts_forPlot_Long <- cellCounts_forPlot_Wide %>% gather(labels, rnaCount, -cellID, -plot_idx)\n    \n    \n    \n    \n    #Color Values\n    colorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n    \n    \n    C7Counts <- cellCounts_forPlot_Long %>% filter(labels == \"C7\")\n    B6Counts <- cellCounts_forPlot_Long %>% filter(labels == \"B6\")\n    \n    #All CELLS\n    AllcellCounts_forPlot <- byCellCounts %>% mutate(plot_idx = seq(1,n())) %>% gather(labels, rnaCount, -cellID, -plot_idx)\n    AllC7Counts <- AllcellCounts_forPlot %>% filter(labels == \"C7\")\n    AllB6Counts <- AllcellCounts_forPlot %>% filter(labels == \"B6\")\n    \n    \n    ## Plot Pie Graph\n    blank_theme <- theme_minimal()+\n      theme(\n        axis.title.x = element_blank(),\n        axis.title.y = element_blank(),\n        panel.border = element_blank(),\n        panel.grid=element_blank(),\n        axis.ticks = element_blank(),\n        plot.title=element_text(size=14, face=\"bold\")\n      )\n    \n    overallPieChart <- ggplot(data = totals) +\n      geom_bar(aes(x=\"\", y = totalFrac, fill = labels), stat = \"identity\", width = 1) +\n      coord_polar(theta=\"y\") + blank_theme + \n      theme(axis.text.x=element_blank()) +\n      geom_text(aes(x = 1.8,  y = totalFrac/3 + c(0,cumsum(totalFrac[-length(totalFrac)])),\n                    label = percent(totalFrac)), size=5) +\n      scale_fill_manual(values = colorVec) +\n      ggtitle(expData$name)\n    plot(overallPieChart)\n    \n    currdir <- getwd()\n    setwd(outSelectdir)\n    ggsave(plot = overallPieChart, filename =   paste(graphName, \"_PIXELSHIFT_OverallPie.pdf\", sep = \"_\"))\n    setwd(currdir)\n    \n    \n    \n",
    "created" : 1449239604813.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2276328252",
    "id" : "6E8170FC",
    "lastKnownWriteTime" : 1449095781,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeSuppFigure2.R",
    "project_path" : "makeSuppFigure2.R",
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "type" : "r_source"
}