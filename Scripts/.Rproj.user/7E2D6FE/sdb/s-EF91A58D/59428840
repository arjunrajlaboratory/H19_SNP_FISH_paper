{
    "contents" : "library(plyr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(tidyr)\nlibrary(scales)\nlibrary(yaml)\nlibrary(reshape2)\n\nsource('SET_ABSOLUTE_PATH.R')\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <-  \"Data_CxB_MEF_9CG_IGF2\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 4/')\noutdir <- file.path(PROJHOME, 'Plots/Supp Figure 4/')\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n(), numGFP = unique(numGFP)) %>%\n  mutate(IGF2 = ifelse(numGFP > 100, T, F))\n\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\ntoJoin <- byCellCounts %>% group_by(cellID) %>% summarise(IGF2 = unique(IGF2))\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\nbyCellCounts_wide <- left_join(byCellCounts_wide, toJoin)\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoFrac <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% mutate(plot_idx = seq(1,n())) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono =  mono >= monoFrac) %>% arrange(isMono, (B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\nIGF2Pos <- cellCounts_forPlot_Wide$plot_idx[cellCounts_forPlot_Wide$IGF2]\nC7IGF2Pos <- cellCounts_forPlot_Wide$C7[cellCounts_forPlot_Wide$IGF2]\n                  \nupDownBar2 <- ggplot() +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= -C7, fill = \"C7\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= B6, fill = \"B6\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_point(aes(x = IGF2Pos, y=  -C7IGF2Pos  -25), label = \"*\", colour = 'green') +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(upDownBar2)\n\ncurrdir <- getwd()\nsetwd(outdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(\"9CG_IGF2_BAR.pdf\", sep = \"_\"))\nsetwd(currdir)\n\nnumGFP <- dataTable %>% group_by(cellID) %>% summarise(numGFP = unique(numGFP))\ncellCounts_forPlot_Wide<- left_join(cellCounts_forPlot_Wide, numGFP)\n\nScatterRatio <- ggplot() +\n  geom_point(data = cellCounts_forPlot_Wide, aes(x = mono, y = numGFP, size = 3)) +\n  geom_line(aes(x = 0.8, y =seq(0,3500,100), colour = 'red'))+\n  xlab(\"C7 Ratio\") +\n  ylab(\"Detected IGF2 RNA Count\") +\n  xlim(0,1) +\n  ylim(0,700) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ggtitle(expData$name)\nplot(ScatterRatio)\n\ncurrdir <- getwd()\nsetwd(outdir)\nggsave(plot = ScatterRatio,  width = 9.89, height = 9,   filename =  paste(\"9CG_IGF2_Scatter.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <-  \"Data_CxB_MEF_WT_IGF2\"\npixelShift <- F\noutSelectdir <- file.path(PROJHOME, 'Plots/Supp Figure 4/')\n\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n(), numGFP = unique(numGFP)) %>%\n  mutate(IGF2 = ifelse(numGFP > 100, T, F))\n\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\ntoJoin <- byCellCounts %>% group_by(cellID) %>% summarise(IGF2 = unique(IGF2))\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\nbyCellCounts_wide <- left_join(byCellCounts_wide, toJoin)\n\n\n##Plotting.....\n\nminDetec <- 15\nmonoFrac <- 0.8\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% filter(B6 + C7 > minDetec) %>% mutate(plot_idx = seq(1,n())) %>% \n  mutate(mono = (C7/(C7+B6))) %>% mutate(isMono =  mono >= monoFrac) %>% arrange(isMono, (B6+C7)) %>% mutate(plot_idx = seq(1,n())) \n\nIGF2Pos <- cellCounts_forPlot_Wide$plot_idx[cellCounts_forPlot_Wide$IGF2]\nC7IGF2Pos <- cellCounts_forPlot_Wide$C7[cellCounts_forPlot_Wide$IGF2]\n\nupDownBar2 <- ggplot() +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= -C7, fill = \"C7\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_bar(data = cellCounts_forPlot_Wide, aes(x = plot_idx, y= B6, fill = \"B6\"), stat = \"identity\",\n           position = \"identity\") +\n  geom_point(aes(x = IGF2Pos, y=  -C7IGF2Pos  -25), label = \"*\", colour = 'green') +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\")) +\n  ggtitle(expData$name)\nplot(upDownBar2)\n\ncurrdir <- getwd()\nsetwd(outdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(\"WT_IGF2_Bar.pdf\", sep = \"_\"))\nsetwd(currdir)\n\nnumGFP <- dataTable %>% group_by(cellID) %>% summarise(numGFP = unique(numGFP))\ncellCounts_forPlot_Wide<- left_join(cellCounts_forPlot_Wide, numGFP)\n\nScatterRatio <- ggplot() +\n  geom_point(data = cellCounts_forPlot_Wide, aes(x = mono, y = numGFP, size = 3)) +\n  geom_line(aes(x = 0.8, y =seq(0,3500,100), colour = 'red') )+\n  xlab(\"C7 Ratio\") +\n  ylab(\"Detected IGF2 RNA Count\") +\n  xlim(0,1) +\n  ylim(0,3000) +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  ggtitle(expData$name)\nplot(ScatterRatio)\n\ncurrdir <- getwd()\nsetwd(outdir)\nggsave(plot = ScatterRatio,  width = 9.89, height = 9,   filename =  paste(\"WT_IGF2_Scatter.pdf\", sep = \"_\"))\nsetwd(currdir)\n\n",
    "created" : 1449239618382.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1912968572",
    "id" : "59428840",
    "lastKnownWriteTime" : 1449105471,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeSuppFigure4.R",
    "project_path" : "makeSuppFigure4.R",
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "type" : "r_source"
}