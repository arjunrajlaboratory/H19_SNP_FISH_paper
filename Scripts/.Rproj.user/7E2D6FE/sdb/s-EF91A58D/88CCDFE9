{
    "contents" : "#Figure 3\n\n\nlibrary(ggplot2)\nlibrary(plyr)\nlibrary(dplyr)\n\n\nsource('SET_ABSOLUTE_PATH.R')\n\ndatadir <- file.path(PROJHOME, 'Raw Data/')\ndataSelect <- \"Data_CxB_9CG_MEFinCRL_IGF2\"\npixelShift <- F\noutdir <- file.path(PROJHOME, 'Plots/Figure 3')\n\n\n\ndataSelectdir <- paste(datadir, \"ExtractedCSVs/\", dataSelect, sep =\"\")\n\nyamldir <- paste(datadir, dataSelect, \"/readMe.yaml\", sep = \"\")\nexpData <- yaml.load_file(yamldir)\n\nif (!pixelShift) {\n  csv <- '_MasterGuideSpotsTable.csv'\n  graphName <- dataSelect\n}else {\n  csv <- '_MasterGuideSpotsTable_Shifted.csv'\n  graphName <- paste(dataSelect, \"_Shifted\", sep = \"\")\n}\n\ntabletoRead <- paste(datadir, \"ExtractedCSVs/\", expData$name, csv, sep = \"\")\ncellArrayObj <- tbl_df(read.csv(paste(datadir, \"ExtractedCSVs/\", expData$name, '_CellArrayObj.csv', sep = \"\"), stringsAsFactors = T))\n\ndataTable <- tbl_df(read.csv(tabletoRead , stringsAsFactors = T))\ndataTable$labels <- revalue(dataTable$labels, c(\"B6 H19 SNPs\"=\"B6\", \"C7 H19 SNPs\"=\"C7\",\n                                                \"H19 B6\" = \"B6\", \"H19 CAST\" = \"C7\", \"CAST\" = \"C7\"))\ndataTable$labels <- factor(dataTable$labels,  c(\"B6\", \"C7\", \"undetec\", \"3-color\"))\n\nbyCellCounts <- dataTable %>% group_by(cellID, labels) %>% summarize(rnaCount = n(), numGFP = unique(numGFP)) %>%\n  mutate(IGF2 = ifelse(numGFP > 100, T, F))\n\n\ntotals <- byCellCounts %>% group_by(labels) %>% summarize(totalCount = sum(rnaCount))\ntotals$name <- as.factor(dataSelect)\ntotals <- totals %>% mutate(totalFrac = totalCount/sum(totalCount))\n\nbyCellCounts_wide <- dataTable %>% xtabs( ~  cellID + labels, data = .) %>% as.data.frame() %>% spread(labels, Freq)\ntoJoin <- byCellCounts %>% group_by(cellID) %>% summarise(IGF2 = unique(IGF2))\nbyCellCounts_wide$cellID <- as.numeric(byCellCounts_wide$cellID)\nbyCellCounts_wide <- left_join(byCellCounts_wide, toJoin)\n\n\ngrouped_Positions <- c(4,6,8,9,11,13,14,17,19,26)\n\nclusterID <- 1;\ncellArrayObj$clusterID = 1;\nfor (i in seq(2,nrow(cellArrayObj))){\n  if ((cellArrayObj$ArrayNum[i-1] == cellArrayObj$ArrayNum[i]) || (cellArrayObj$ArrayNum[i] %in% grouped_Positions)) {\n    cellArrayObj$clusterID[i] <- clusterID    \n  }\n  else{\n  clusterID <- clusterID + 1\n  cellArrayObj$clusterID[i] <- clusterID \n  }\n}\n\n\ncellCounts_forPlot_Wide <- byCellCounts_wide %>% left_join(cellArrayObj)\n\n#FILTER COLONIES that are high expressing with 3-4 cells\nfilterID <- c(5:7, 10:13, 24:28, 29:31, 35:39, 46:50, 57:60)\ncellCounts_forPlot_Wide <- cellCounts_forPlot_Wide %>% filter(seq(1,nrow(cellCounts_forPlot_Wide)) %in% filterID)\n\n\nnullRow <- as.data.frame(t(rep(0,9)))\nnullRow <- rbind(nullRow, nullRow, nullRow, nullRow)\ncolnames(nullRow) <- colnames(cellCounts_forPlot_Wide)\n\n\nnewCellCounts_forPlot_Wide <- cellCounts_forPlot_Wide[1,]\n\nfor (i in seq(2, nrow(cellCounts_forPlot_Wide))){\n  if (cellCounts_forPlot_Wide$clusterID[i] != cellCounts_forPlot_Wide$clusterID[i-1]){\n    newCellCounts_forPlot_Wide <- rbind(newCellCounts_forPlot_Wide, nullRow)\n  }\n  newCellCounts_forPlot_Wide <- rbind(newCellCounts_forPlot_Wide, cellCounts_forPlot_Wide[i,])\n}\n\n\n\n#Color Values\ncolorVec <- c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\", \"undetec\" = \"grey\", \"3-color\" = \"brown\")\n\n\nnewCellCounts_forPlot_Wide$numRow = 1:nrow(newCellCounts_forPlot_Wide)\n\nIGF2Plot <- newCellCounts_forPlot_Wide %>% filter(IGF2 == 1) \n\nupDownBar2 <- ggplot() +\n  geom_bar(data = newCellCounts_forPlot_Wide, aes(x = 1:nrow(newCellCounts_forPlot_Wide), y = -C7,\n                                                  fill = \"C7\"), stat = \"identity\", position = \"dodge\") +\n  geom_bar(data = newCellCounts_forPlot_Wide, aes(x = 1:nrow(newCellCounts_forPlot_Wide), y = B6, fill = \"B6\"), stat = \"identity\") +\n  geom_point(data = IGF2Plot, aes(x = numRow, y = (-C7 - 25)), label = \"*\", colour = 'green' ) +\n  coord_flip() +\n  xlab(\"Individual Cells\") +\n  ylab(\"RNA Count\") +\n  theme_bw(base_size = 20, base_family = \"Helvetica\") +\n  theme(axis.ticks = element_blank(), axis.text.y = element_blank(), \n        panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +\n  scale_fill_manual(values = c(\"B6\" =\"deepskyblue1\", \"C7\" = \"orange\"), name = 'Allele') +\n  ggtitle(expData$name)\nplot(upDownBar2)\ncurrdir <- getwd()\nsetwd(outdir)\nggsave(plot = upDownBar2,  width = 9.89, height = 9,   filename =  paste(\"Figure3_IGF2_COLONY_PLOT.pdf\", sep = \"_\"))\nsetwd(currdir)",
    "created" : 1449159652430.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1294025242",
    "id" : "88CCDFE9",
    "lastKnownWriteTime" : 1449095481,
    "path" : "/Volumes/SNPFISH_H19/H19 SNP-FISH Paper/Scripts/makeFigure3.R",
    "project_path" : "makeFigure3.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}